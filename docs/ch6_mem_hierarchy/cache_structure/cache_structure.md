# 📦 6.4 캐시 메모리 (Cache Memories)

캐시 메모리는 CPU와 메인 메모리(또는 보조 기억 장치) 사이에 위치하여, 자주 접근하는 데이터를 임시로 저장해두는 저장 장치다.  
CPU가 데이터를 요청할 때, 해당 데이터가 캐시에 있으면 이를 바로 전달하여 접근 시간을 줄일 수 있다.

---

## 6.4.1 기본 캐시 메모리 구조 (Generic Cache Memory Organization)

### Cache Block

캐시 메모리는 데이터를 **캐시 블록(Cache Block)** 단위로 저장한다.  
각 블록은 다음과 같은 구성 요소를 가진다:

- **데이터(Data)**: 실제 메모리의 내용을 담는다.  
- **태그(Tag)**: 해당 블록이 메모리의 어느 위치를 나타내는지를 식별한다.  
- **유효 비트(Valid Bit)**: 해당 블록의 데이터가 유효한지를 나타낸다.

유효 비트가 0이면 해당 캐시 블록이 비어있거나 잘못된 데이터를 가지고 있음을 의미한다.

캐시는 총 **S개의 세트(Set)** 로 구성되고, 각 세트는 **E개의 캐시 라인(Line)** 또는 **엔트리(Entry)** 로 구성된다.  
각 캐시 라인은 하나의 캐시 블록을 담는다.

---

## 6.4.2 직접 매핑 캐시 (Direct-Mapped Cache)

직접 매핑 캐시는 각 세트에 정확히 하나의 캐시 라인(E = 1)만 존재하는 구조다.  
구현이 단순하고 이해하기 쉬운 편이다.

![Direct-Mapped Cache](/assets/ch6_mem_hierarchy/cache_structure/directed_map.png)


### 동작 과정

1. **세트 선택**  
   주소 A에서 세트 인덱스 비트를 추출하여 하나의 세트를 선택한다.

2. **라인 매칭**  
   선택된 세트의 유효 비트가 1이고, 태그 비트가 주소의 태그와 일치하면 캐시 히트다.

3. **워드 추출**  
   블록 오프셋 비트를 이용해 원하는 데이터를 추출한다.

### 단점

- 동일한 세트 인덱스를 가지는 서로 다른 주소들이 **하나의 캐시 라인에만 저장될 수 있기 때문에**, 충돌이 잦아진다.
- 따라서 **경합 미스(conflict miss)** 가 자주 발생할 수 있다.

---

## 6.4.3 완전 연관 캐시 (Fully Associative Cache)

완전 연관 캐시는 **캐시에 단 하나의 세트만 존재하고**, 모든 캐시 라인이 그 세트에 속하는 구조다.

이 구조에서는 주소의 **태그**를 모든 라인의 태그와 비교해 일치 여부를 확인하며, **세트 인덱스**는 존재하지 않는다.

![Direct-Mapped Cache](/assets/ch6_mem_hierarchy/cache_structure/fully_associative.png)

### 장점

- 데이터가 어느 위치에나 저장될 수 있어, 유연성이 매우 높다.

### 단점

- 모든 태그를 동시에 비교해야 하므로, **하드웨어 구현이 복잡**하고 **비용이 높다**.

---

## 6.4.4 집합 연관 캐시 (Set-Associative Cache)

집합 연관 캐시는 직접 매핑과 완전 연관 방식의 절충형 구조다.  
하나의 세트에 **2개 이상(E ≥ 2)** 의 캐시 라인이 존재한다.

예를 들어, **4-way 집합 연관 캐시**는 하나의 세트에 4개의 라인을 가진다.

![Direct-Mapped Cache](/assets/ch6_mem_hierarchy/cache_structure/set_associative.png)

### 동작 과정

1. **세트 선택**  
   주소에서 세트 인덱스를 추출하여 하나의 세트를 선택한다.

2. **라인 매칭**  
   선택된 세트 내의 라인들 중 유효 비트가 1이고 태그가 일치하는 라인을 찾는다.

3. **워드 추출**  
   블록 오프셋을 통해 데이터를 추출한다.

4. **캐시 미스 시**  
   - 비어 있는 라인이 있다면 거기에 데이터를 저장한다.  
   - 모두 사용 중이라면 교체 정책(LRU, FIFO 등)에 따라 하나를 교체한다.

---

## 캐시 매핑 방식 비교

| 매핑 방식       | 세트 수(S) | 세트당 라인 수(E) | 장점                | 단점                  |
|----------------|------------|-------------------|---------------------|-----------------------|
| 직접 매핑       | 많음       | 1                 | 구현이 단순함       | 충돌이 잦고 유연성 부족 |
| 완전 연관       | 1          | 많음              | 저장 위치 자유로움  | 하드웨어 복잡, 느림     |
| 집합 연관       | 중간       | 2 이상            | 유연성과 효율성 조화 | 구현이 다소 복잡함     |

---

## 용어 정리

- **캐시 히트(Cache Hit)**: CPU가 요청한 데이터가 캐시에 존재하는 경우
- **캐시 미스(Cache Miss)**: 캐시에 없는 경우
- **태그(Tag)**: 메모리 블록의 위치를 식별하는 정보
- **세트 인덱스(Set Index)**: 주소로부터 세트를 선택하기 위한 비트
- **블록 오프셋(Block Offset)**: 블록 내에서 원하는 데이터 위치를 찾기 위한 비트
- **교체 정책(Replacement Policy)**: 캐시가 꽉 찼을 때 교체할 블록을 결정하는 규칙 (LRU, FIFO 등)
