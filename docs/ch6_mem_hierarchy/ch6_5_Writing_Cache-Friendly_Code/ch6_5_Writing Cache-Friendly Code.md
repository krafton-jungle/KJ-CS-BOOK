## 6.5 캐시 친화적 코드 작성

1. 공간 지역성 (Spatial Locality) 활용
- 데이터가 메모리에 연속적으로 배치되면 캐시 블록에 한 번에 들어온다.
- 배열 순차 접근(예: for (i=0; i<N; i++) a[i])이 대표적이다.
- 큰 구조체/배열에서 필요한 필드나 원소를 인접하게 배치한다.
1. 시간 지역성 (Temporal Locality) 활용
- 한 번 접급한 데이터는 가까운 시점에 다시 사용하면 캐시에 남아 있다.
- 변수 재사용, 루프 내부에서 반복 사용되는 값은 캐시에 계속 머무른다.

---

구현 전략

- 배열 순차 접근 : 행 우선(row-major) 순서로 순회 (C는 row-major)하기.
- 루프 구조 최적화 : 중첩 루프의 순서 변경으로 지역성 개선하기.
- 작은 워킹 셋 유지 : 동시에 사용하는 데이터 양을 캐시 크기 이하로 제한하기.
- 블로킹(Blocking) : 큰 데이트 처리를 캐시 블록 단위로 나누어 작업하기.
- 데이터 구조 설계 : 연결 리스트보다 연속된 배열 사용을 선호하기.

---

예시

- 비효율적인 코드

```c
for (j=0; j<N; j++)
    for (i=0; i<M; i++)
        sum += a[i][j]; // 열 우선 접근 → 캐시 미스 증가
```

- 비연속 메모리 접근 → 매번 새로운 캐시 블록 로드
- 캐시 미스율 높아지고 성능 저하

---

- 개선된 코드

```c
for (i=0; i<M; i++)
    for (j=0; j<N; j++)
        sum += a[i][j]; // 행 우선 접근 → 캐시 친화적
```

- C 언어 배열 저장 방식과 일치
- 캐시 블록에 연속 데이터가 들어오므르 공간 지역성 상승
- 히트율 높고 성능 우수